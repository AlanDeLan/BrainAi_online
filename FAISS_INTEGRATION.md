# Інтеграція FAISS як альтернативи ChromaDB

## Проблема

ChromaDB не працює в EXE режимі через відсутність нативних Rust компонентів (`chromadb.api.rust`). Це робить векторну базу даних недоступною, що є критичною проблемою, оскільки векторна база - це ключова функціональність додатку.

## Рішення

Додано **FAISS** як автоматичний fallback для ChromaDB. FAISS - це повністю Python-реалізована векторна база даних, яка працює з PyInstaller.

### Як це працює:

1. **Спочатку пробуємо ChromaDB:**
   - Якщо ChromaDB працює (в Python режимі) - використовуємо його
   - Якщо ChromaDB не працює (в EXE режимі) - автоматично переходимо на FAISS

2. **FAISS як fallback:**
   - Автоматично ініціалізується, якщо ChromaDB недоступний
   - Використовує sentence-transformers для генерації embeddings
   - Зберігає дані в тій самій директорії (`vector_db_storage/`)

## Реалізація

### Створені файли:

1. **`vector_db/faiss_client.py`** - FAISS клієнт з повною підтримкою:
   - Збереження чатів (`add`)
   - Оновлення чатів (`update`)
   - Пошук чатів (`query`)
   - Видалення чатів (`delete`)
   - Отримання всіх чатів (`get`)

2. **Оновлено `vector_db/client.py`:**
   - Додано автоматичний fallback на FAISS
   - Всі функції підтримують обидві бази даних
   - Експортовано `use_faiss` та `faiss_db` для перевірки типу

3. **Оновлено `requirements.txt`:**
   - Додано `faiss-cpu`
   - Додано `sentence-transformers`

4. **Оновлено `run_app.spec`:**
   - Додано hidden imports для FAISS та sentence-transformers
   - Додано збірку даних sentence-transformers та transformers

5. **Оновлено `main.py`:**
   - API endpoints підтримують обидві бази даних
   - Статистика показує тип використовуваної бази

## Використання

### В Python режимі:
- Використовується ChromaDB (якщо доступний)
- FAISS не використовується

### В EXE режимі:
- ChromaDB не працює (Rust компоненти недоступні)
- Автоматично використовується FAISS
- Всі функції векторної бази працюють через FAISS

## Переваги FAISS

1. **Повністю на Python:**
   - Не потребує нативних компонентів
   - Працює з PyInstaller

2. **Швидкий:**
   - Оптимізований для векторного пошуку
   - Ефективні алгоритми пошуку

3. **Сумісний API:**
   - Схожий до ChromaDB API
   - Легка інтеграція

## Моделі embeddings

FAISS використовує sentence-transformers для генерації embeddings:

1. **Спробує завантажити:** `paraphrase-multilingual-MiniLM-L12-v2` (мультимовна)
2. **Fallback:** `all-MiniLM-L6-v2` (англійська)
3. **Останній fallback:** `sentence-transformers/all-MiniLM-L6-v2`

Моделі завантажуються автоматично при першому використанні.

## Збереження даних

FAISS зберігає дані в тій самій директорії, що й ChromaDB:
- `vector_db_storage/faiss.index` - FAISS індекс
- `vector_db_storage/metadata.json` - метадані
- `vector_db_storage/documents.pkl` - документи

## Статус

- ✅ FAISS клієнт створено
- ✅ Автоматичний fallback реалізовано
- ✅ Всі функції підтримують обидві бази
- ✅ Збірка оновлена
- ✅ Документація створена

## Тестування

Після збірки EXE:

1. Запустіть `dist\LocalBrain.exe`
2. Перевірте логи - має бути повідомлення про ініціалізацію FAISS
3. Надішліть повідомлення в чат
4. Перевірте векторну базу - має заповнитися через FAISS
5. Перевірте статистику - має показувати тип "FAISS"

## Важливо

- **В Python режимі:** Використовується ChromaDB (якщо доступний)
- **В EXE режимі:** Автоматично використовується FAISS
- **Дані сумісні:** Обидві бази використовують одну директорію, але різні формати файлів
- **Моделі:** Завантажуються автоматично при першому використанні (може зайняти час)





