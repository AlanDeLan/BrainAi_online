# Як заповнюється векторна база даних

## Автоматичне збереження

Векторна база даних (ChromaDB) заповнюється **автоматично** під час роботи з чатом, якщо виконані наступні умови:

### Умови збереження:

1. **Чекбокс "Запам'ятати цей чат" увімкнено**
   - За замовчуванням цей чекбокс **увімкнений** ✅
   - Знаходиться внизу екрану, під полем введення повідомлення
   - Якщо чекбокс вимкнено, чат **НЕ** зберігається в векторну базу

2. **Надсилання повідомлень в чат**
   - Кожного разу, коли ви надсилаєте повідомлення в чат, весь чат (всі повідомлення) зберігається або оновлюється в векторній базі даних
   - Перше повідомлення створює новий запис
   - Наступні повідомлення оновлюють існуючий запис цього чату

### Як це працює:

1. **Перше повідомлення в чаті:**
   - Автоматично створюється `chat_id` (ідентифікатор чату)
   - Всі повідомлення зберігаються в файл історії (`history/`)
   - Весь чат зберігається в векторну базу даних як один документ

2. **Наступні повідомлення:**
   - Використовується той самий `chat_id`
   - Історія чату оновлюється
   - Векторна база даних **оновлює** весь чат (не додає новий запис, а оновлює існуючий)

3. **Новий чат:**
   - При натисканні кнопки "Новий чат" створюється новий `chat_id`
   - Новий чат зберігається як окремий запис у векторній базі

### Де зберігаються дані:

- **Векторна база даних**: `vector_db_storage/` (поруч з exe файлом)
- **Історія чатів**: `history/` (JSON файли)

### Як перевірити, чи працює збереження:

1. **Перевірте чекбокс:**
   - Переконайтеся, що чекбокс "Запам'ятати цей чат" **увімкнено** ✅

2. **Надішліть повідомлення:**
   - Виберіть архетип
   - Введіть повідомлення
   - Натисніть "Відправити"

3. **Перевірте векторну базу:**
   - Відкрийте меню (три точки) → "Векторна база даних"
   - Ви повинні побачити запис з вашим чатом

4. **Перевірте статистику:**
   - Відкрийте меню (три точки) → "Статистика"
   - У розділі "Vector DB" має бути вказано кількість записів

### Можливі проблеми:

1. **База даних порожня:**
   - Перевірте, чи увімкнено чекбокс "Запам'ятати цей чат"
   - Переконайтеся, що ви надсилали повідомлення з увімкненим чекбоксом
   - Перевірте логи на наявність помилок (файл `logs/` або консоль)

2. **Помилки збереження:**
   - Помилки збереження в векторну базу **не переривають** обробку повідомлення
   - Помилки логуються в логи (статус `WARNING`)
   - Перевірте логи для деталей помилки

3. **База даних не ініціалізується:**
   - Перевірте права доступу до директорії `vector_db_storage/`
   - Перевірте, чи встановлено бібліотеку `chromadb`
   - Перевірте логи на помилки ініціалізації

4. **ChromaDB не працює в EXE режимі (важливо!):**
   - **В EXE режимі ChromaDB може бути недоступним** через наявність нативних Rust компонентів
   - Якщо ви бачите помилку `ModuleNotFoundError: No module named 'chromadb.api.rust'`, це нормально для EXE версії
   - Додаток **продовжить працювати** навіть без векторної бази даних
   - Історія чатів все одно зберігається в файли (`history/`)
   - Векторний пошук та збереження контексту будуть недоступні
   - Для повної функціональності векторної бази використовуйте Python скрипт замість EXE

### Використання векторної бази:

Векторна база даних використовується **автоматично** асистентом для поглиблення контексту:

#### 1. **Автоматичний пошук контексту (для асистента):**

При кожному запиті асистент **автоматично** використовує векторну базу для:

- **Пошуку релевантних повідомлень в поточному чаті:**
  - Шукає до 3 найбільш релевантних повідомлень з поточного чату
  - Забезпечує безперервність розмови

- **Пошуку релевантних чатів з усієї бази:**
  - Шукає до 2 найбільш релевантних чатів з усієї бази даних
  - Дозволяє асистенту "пам'ятати" попередні розмови на схожі теми
  - Забезпечує глибший контекст без передачі всієї історії

**Як це працює:**
1. Ви надсилаєте повідомлення
2. Система автоматично шукає релевантний контекст у векторній базі
3. Знайдений контекст додається до запиту
4. Асистент отримує більш релевантну відповідь з урахуванням попередніх розмов

**Приклад:**
- Якщо ви раніше обговорювали "Python програмування" в одному чаті
- А потім в іншому чаті запитуєте про "синтаксис Python"
- Асистент автоматично знайде попередню розмову і використає її для контексту

#### 2. **Ручний пошук через інтерфейс (для користувача):**

Ви можете самостійно шукати та переглядати чати:

- **Відкрийте меню** → "Векторна база даних"
- **Пошук чатів:**
  - Введіть запит у поле пошуку
  - Натисніть "Пошук" або Enter
  - Система знайде найбільш релевантні чати за семантичною схожістю
- **Перегляд записів:**
  - Натисніть "Переглянути" для детального перегляду
  - Натисніть "Редагувати" для зміни запису
  - Натисніть "Видалити" для видалення запису

#### 3. **Аналіз історії:**
   - Всі збережені чати доступні для перегляду та редагування
   - Можна видаляти або оновлювати записи
   - Статистика показує кількість записів у базі

### Примітки:

- **Важливо:** Кожне нове повідомлення оновлює **весь чат** у векторній базі, а не додає новий запис
- **Чекбокс за замовчуванням увімкнено**, тому зазвичай збереження відбувається автоматично
- Якщо ви хочете вимкнути збереження для конкретного чату, просто вимкніть чекбокс перед надсиланням повідомлень

